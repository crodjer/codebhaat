{% extends "base_weblog.html" %}
{% load comments humanize cache valuation %}
{% block title %}Weblog | {{ object.headline|escape }}{% endblock %}

{% block content %}
<h1>{{ object.headline|safe }}</h1>
{{ object.body|safe }}
<p class="date small">Posted by <strong>{{ object.author }}</strong> on {{ object.pub_date|date:"F j, Y" }}</p>

{% get_comment_count for object as comment_count %}
{% get_comment_list for object as comment_list %}
{% get_comment_form for object as form %}

<h3>Comments({{ comment_count }})</h3>
<table>
    {% for c in comment_list %}        
    <tr><th style="width:100px;">{% if c.user.get_profile %}<a href="{% url profiles_profile_detail c.user %}">{{ c.user }}</a>{% else %}{{ c.user }}{% endif %} says <br/><span style="font-size:9px; text-weight:none;">{{ c.submit_date|timesince }} ago</span></th><td style="">{{ c.comment|linebreaksbr }}</td><tr>
            {% endfor %}
        </table>  
        {% if request.user.is_active %}
        <h4>Your comment</h4>
        <script language="JavaScript" type="text/javascript">
            function checkform ( form )
{
    if (form.comment.value == "") {
        alert( "Please enter your comment." );
        form.comment.focus();
        return false ;
    }
    return true ;
}
</script>
<form action="{% comment_form_target %}" method="post" onsubmit="return checkform(this);">
    <table>
        {% for field in form.hidden_fields %}
        {{ field }}
        {% endfor %}
        <tr style="display:none">
            <th><label for="id_name">Name</label></th> <td><input id="id_name" type="text" name="name" maxlength="50" value="{{request.user.username }}"/></td>
        </tr>
        <tr style="display:none">
            <th><label for="id_email">Email address</label></th> <td><input type="text" name="email" id="id_email" value="{{request.user.email }}"/></td>
        </tr>
        <tr style="display:none">
            <th><label for="id_url">URL</label></th> <td><input type="text" name="url" id="id_url" /></td>
        </tr>
        <tr>
            <th><label for="id_comment">Comment</label></th> <td><textarea id="id_comment" name="comment"  style="width:580px; max-width:580px; height:80px; max-height:150px;"></textarea></td>
        </tr>
        <tr>
            <td></td>
            <td><input type="submit" name="post" class="submit-post" value="Post"></td>
            <input type="hidden" name="next" value="{{ object.get_absolute_url }}" />
        </tr>
    </table>
</form>
{% else %}
<h4>Please <a href="/login/">login</a> to comment on this blog post.</h4>
{% endif %}
{% endblock %}
